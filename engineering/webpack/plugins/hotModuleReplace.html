<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>深入Webpack的HMR机制 | Jayconscious</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/blog/assets/img/favicon.ico">
    <meta name="description" content="Just playing around">
    
    <link rel="preload" href="/blog/assets/js/commons~ae3b4e4a.464a596b.js" as="script"><link rel="preload" href="/blog/assets/js/commons~7181f674.4662fd2d.js" as="script"><link rel="preload" href="/blog/assets/js/commons~786cfedb.e41f506a.js" as="script"><link rel="preload" href="/blog/assets/js/commons~aace9167.f4e3ef15.js" as="script"><link rel="preload" href="/blog/assets/js/commons~9b484c39.32a77623.js" as="script"><link rel="preload" href="/blog/assets/js/commons~7860dd99.672b1e82.js" as="script"><link rel="preload" href="/blog/assets/js/commons~a72e7967.48eaee7f.js" as="script"><link rel="preload" href="/blog/assets/js/commons~a90c22bc.54f8d524.js" as="script"><link rel="preload" href="/blog/assets/js/commons~929f0a25.dce5cbc5.js" as="script"><link rel="preload" href="/blog/assets/js/commons~c27f1b1d.585814cf.js" as="script"><link rel="preload" href="/blog/assets/js/commons~cdd1d9fd.e1032346.js" as="script"><link rel="preload" href="/blog/assets/js/commons~0bcc290c.a80123bc.js" as="script"><link rel="preload" href="/blog/assets/js/commons~2e021842.acbeda30.js" as="script"><link rel="preload" href="/blog/assets/js/commons~f188b1ac.8e2d0f5c.js" as="script"><link rel="preload" href="/blog/assets/js/commons~d6eb103f.6dc63174.js" as="script"><link rel="preload" href="/blog/assets/js/commons~5c078696.d1d90f20.js" as="script"><link rel="preload" href="/blog/assets/js/commons~f1a1cd68.64a52a3e.js" as="script"><link rel="preload" href="/blog/assets/js/commons~f54afab4.907e7ee2.js" as="script"><link rel="preload" href="/blog/assets/js/commons~54aeb72e.ce3d8ca8.js" as="script"><link rel="preload" href="/blog/assets/css/19.styles.afed1185.css" as="style"><link rel="preload" href="/blog/assets/js/commons~d0ae3f07.afed1185.js" as="script"><link rel="preload" href="/blog/assets/css/16.styles.15a304df.css" as="style"><link rel="preload" href="/blog/assets/js/commons~b5906859.15a304df.js" as="script"><link rel="preload" href="/blog/assets/js/commons~ec8c427e.1e7f6dc0.js" as="script"><link rel="preload" href="/blog/assets/css/25.styles.396d34f8.css" as="style"><link rel="preload" href="/blog/assets/js/commons~fdc6512a.396d34f8.js" as="script"><link rel="preload" href="/blog/assets/css/5.styles.149ee583.css" as="style"><link rel="preload" href="/blog/assets/js/commons~6a2c4da6.149ee583.js" as="script"><link rel="preload" href="/blog/assets/js/commons~205977d4.e74f882a.js" as="script"><link rel="preload" href="/blog/assets/js/commons~7dcdd765.06c066b0.js" as="script"><link rel="preload" href="/blog/assets/js/app.2c482c1e.js" as="script">
    <link rel="stylesheet" href="/blog/assets/css/19.styles.afed1185.css"><link rel="stylesheet" href="/blog/assets/css/16.styles.15a304df.css"><link rel="stylesheet" href="/blog/assets/css/25.styles.396d34f8.css"><link rel="stylesheet" href="/blog/assets/css/5.styles.149ee583.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-7dd95ae2><div data-v-7dd95ae2><div class="password-shadow password-wrapper-out" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88>Jayconscious</h3> <p class="description" data-v-59e6cb88>Just playing around</p> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><span data-v-59e6cb88>jayconscious</span>
          
        <span data-v-59e6cb88>2020 - </span>
        2025
      </a></span></div></div> <div class="hide" data-v-7dd95ae2><header class="navbar" data-v-7dd95ae2><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">Jayconscious</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/categories/algorithm/" class="nav-link"><i class="undefined"></i>
  algorithm
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/Javascript/" class="nav-link"><i class="undefined"></i>
  Javascript
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/Engineering/" class="nav-link"><i class="undefined"></i>
  Engineering
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/asyncProgramming/" class="nav-link"><i class="undefined"></i>
  asyncProgramming
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/Node.js/" class="nav-link"><i class="undefined"></i>
  Node.js
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/protocol/" class="nav-link"><i class="undefined"></i>
  protocol
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/other/" class="nav-link"><i class="undefined"></i>
  other
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/react/" class="nav-link"><i class="undefined"></i>
  react
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/Vue2/" class="nav-link"><i class="undefined"></i>
  Vue2
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/Vuex/" class="nav-link"><i class="undefined"></i>
  Vuex
</a></li></ul></div></div><div class="nav-item"><a href="/blog/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><a href="/blog/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><a href="https://github.com/jayconscious" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-7dd95ae2></div> <aside class="sidebar" data-v-7dd95ae2><div class="personal-info-wrapper" data-v-1fad0c41 data-v-7dd95ae2><img src="/blog/assets/img/avatar.png" alt="author-avatar" class="personal-img" data-v-1fad0c41> <h3 class="name" data-v-1fad0c41>
    jayconscious
  </h3> <div class="num" data-v-1fad0c41><div data-v-1fad0c41><h3 data-v-1fad0c41>75</h3> <h6 data-v-1fad0c41>Articles</h6></div> <div data-v-1fad0c41><h3 data-v-1fad0c41>12</h3> <h6 data-v-1fad0c41>Tags</h6></div></div> <ul class="social-links" data-v-1fad0c41></ul> <hr data-v-1fad0c41></div> <nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/categories/algorithm/" class="nav-link"><i class="undefined"></i>
  algorithm
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/Javascript/" class="nav-link"><i class="undefined"></i>
  Javascript
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/Engineering/" class="nav-link"><i class="undefined"></i>
  Engineering
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/asyncProgramming/" class="nav-link"><i class="undefined"></i>
  asyncProgramming
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/Node.js/" class="nav-link"><i class="undefined"></i>
  Node.js
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/protocol/" class="nav-link"><i class="undefined"></i>
  protocol
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/other/" class="nav-link"><i class="undefined"></i>
  other
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/react/" class="nav-link"><i class="undefined"></i>
  react
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/Vue2/" class="nav-link"><i class="undefined"></i>
  Vue2
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/Vuex/" class="nav-link"><i class="undefined"></i>
  Vuex
</a></li></ul></div></div><div class="nav-item"><a href="/blog/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><a href="/blog/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><a href="https://github.com/jayconscious" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav> <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><a href="/blog/engineering/webpack/loaders/vueLoader" class="sidebar-heading clickable"><span>Loaders</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/engineering/webpack/loaders/vueLoader.html" class="sidebar-link">深入 vue-loader 原理</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/blog/engineering/webpack/plugins/hotModuleReplace" class="sidebar-heading clickable open active"><span>Plugins</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/engineering/webpack/plugins/hotModuleReplace.html" aria-current="page" class="active sidebar-link">深入Webpack的HMR机制</a></li></ul></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88>深入Webpack的HMR机制</h3> <!----> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><span data-v-59e6cb88>jayconscious</span>
          
        <span data-v-59e6cb88>2020 - </span>
        2025
      </a></span></div></div> <div data-v-7dd95ae2><div data-v-7dd95ae2><main class="page"><section style="display:;"><div class="page-title"><h1 class="title">深入Webpack的HMR机制</h1> <div data-v-8a445198><i class="iconfont reco-account" data-v-8a445198><span data-v-8a445198>jayconscious</span></i> <i class="iconfont reco-date" data-v-8a445198><span data-v-8a445198>9/16/2021</span></i> <i class="iconfont reco-eye" data-v-8a445198><span id="/blog/engineering/webpack/plugins/hotModuleReplace.html" data-flag-title="Your Article Title" class="leancloud-visitors" data-v-8a445198><a class="leancloud-visitors-count" style="font-size:.9rem;font-weight:normal;color:#999;"></a></span></i> <i class="tags iconfont reco-tag" data-v-8a445198><span class="tag-item" data-v-8a445198>webpack</span></i></div></div> <div class="theme-reco-content content__default"><h2 id="前言"><a href="#前言" class="header-anchor">#</a> 前言</h2> <p>在我刚学习 <code>vue</code> 的时候，接触<code>vue-cli</code>的时候，在开发是被其提供的热加载功能深深的吸引住了。很好奇它是如何将我们所修改的代码通过不刷新方式，来更新 <code>web</code> 应用，与此同时还能保持应用的一些状态，这在我们平时日常开发之中是非常有用。后来再知道提供浙一功能的是 <code>webpack</code> 的一个插件模块 <code>hotModuleReplace</code> 所提供的能力，本文就带大家一起来探究一下它是如何实现的。</p> <h2 id="抛出疑问"><a href="#抛出疑问" class="header-anchor">#</a> 抛出疑问</h2> <p>对于我们不熟悉或者压根没有接触的东西，通过抛出疑问，自己解决这些疑问可以很好帮我们去提升自己的能力，这是很好成长的机会。</p> <ol><li><p>通过 <code>webpack</code> 打包之后的文件存放在哪里？在没有 <code>writeToDisk: true</code> 这个配置项时。</p></li> <li><p>打包器在工作时是如何和 <code>client</code> 进行交互的？</p></li> <li><p>新生成的模块是如何作用于浏览器应用的。</p></li></ol> <p>一开始的时候我们抛出的问题的颗粒度比较粗，没有关系，随着我们一步步的探索，我们又会遇到一些细节的问题，把这细节问题梳理清楚了，从而对整个问题就有了更深的理解了。</p> <h2 id="hmr-流程图解"><a href="#hmr-流程图解" class="header-anchor">#</a> HMR 流程图解</h2> <p><img src="/blog/assets/img/webpack/plugin/hmr4.png" alt="image"></p> <p>上图描述了一个完整<code>HMR</code>流程，我们来看看它是如何运转的。</p> <ol><li><p>在 <code>webpack</code> 的监听模式下，在我们所编写的文件保存之后，会触发其重新编译，完成之后的<code>bundle</code>保存在内存之中。在编译打包时，<code>webpack</code>的<code>ProgressPlugin</code>这个插件将编译进度通过 <code>websocket</code> 推送到浏览器端。</p></li> <li><p>在 <code>webpack-dev-server</code>与<code>webpack</code>之间主要是由 <code>webpack-dev-middleware</code>来进行交互的，这里它主要做了两件事：一是，通过 <code>webpack-dev-middleware</code> 调用<code>webpack</code>生成的<code>compiler</code>的相关api，告诉其将打包之后的文件是写入内存之后，还是写到硬盘上，依据<code>writeToDisk</code>配置项。二是，<code>webpack-dev-middleware</code>调用返回的是一个<code>express</code>标准的中间件，向<code>app</code>上注册路由，拦截 <code>HTTP</code> 收到的请求，根据请求路径响应对应的文件内容；</p></li> <li><p>这一步，浏览器主要是通过 <code>sockjs</code> 这个库与服务器端的 <code>websocket</code>服务建立长连接通信，将 <code>webpack</code>编译打包的各个阶段推送浏览器端，依此会有不同的操作，最为核心的就是服务端推送新<code>hash</code>时，浏览器端会依据这个<code>hash</code>来进行后续的热更新逻辑。</p></li> <li><p>当服务端推送的消息<code>type</code>为<code>ok</code>时，<code>webpack-dev-server/client</code>会执行<code>reloadApp</code>方法，主要是为了触发<code>webpackHotUpdate</code>事件，在<code>webpack/hot/dev-server</code>依据相关的配置和传递的信息决定是否要刷新页面还是要热更新，这两者联系的纽带是<code>webpack/hot/emitter</code>，依赖的是<code>node</code>的<code>events</code>模块，在浏览器也能生效，说明其是和平台无关的。</p></li> <li><p>在<code>webpack/hot/dev-server</code>中会通过调用<code>module.hot.check</code>方法映射到<code>HotModuleReplacement.runtime</code>中的<code>hotCheck</code>方法，这些方法是通过 <code>HotModuleReplacementPlugin</code>注入到<code>bendle</code>之中。</p></li> <li><p><code>hotCheck</code> 然后会调用<code>JsonpMainTemplate.runtime</code>中的<code>hotDownloadManifest</code>和<code>hotDownloadUpdateChunk</code>方法。</p></li> <li><p><code>hotDownloadManifest</code>携带上推送的 <code>hash</code>发起<code>ajax</code>请求，获取最新的文件列表。</p></li> <li><p><code>hotDownloadUpdateChunk</code> 依据文件列表发起<code>jsonp</code>请求相应的最新的代码块，继续后续代码更新的逻辑。</p></li> <li><p>代码更新时，会进行新旧模块的对比，决定是否要更新。如果要更新，将梳理清楚模块之间的依赖，然后更新模块以及相关的依赖；如果更新失败了，就会通过刷新的方式来进行兜底操作。</p></li></ol> <h2 id="运行demo"><a href="#运行demo" class="header-anchor">#</a> 运行Demo</h2> <p>下面我们通过一个简单的例子来说明。来说明一些其中的一些细节问题，以大家最为熟悉的 <code>vue</code>为例。</p> <p>我们来初始化一个基本<code>vue</code>项目，相关目录以及核心配置如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>Demo
├─ main<span class="token punctuation">.</span>js
├─ <span class="token keyword">package</span><span class="token punctuation">.</span>json
├─ <span class="token keyword">public</span>
│    └─ index<span class="token punctuation">.</span>html
├─ test<span class="token punctuation">.</span>vue
├─ webpack<span class="token punctuation">.</span>config<span class="token punctuation">.</span>js
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><code>webpack.config.js</code> 的配置如下，</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">{</span>
  <span class="token literal-property property">devtool</span><span class="token operator">:</span> <span class="token string">'source-map'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">'development'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">entry</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./main.js'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">'bundle.js'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">devServer</span><span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">==</span> <span class="token string">'production'</span> <span class="token operator">?</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token operator">:</span><span class="token punctuation">{</span>
    <span class="token literal-property property">contentBase</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">hot</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">writeToDisk</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.vue$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'vue-loader'</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">VueLoaderPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">template</span><span class="token operator">:</span> <span class="token string">'./public/index.html'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p><code>package.json</code> 的配置如下，</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token string-property property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token string-property property">&quot;dev&quot;</span><span class="token operator">:</span> <span class="token string">&quot;rm -rf ./dist &amp;&amp; NODE_ENV=development webpack-dev-server --config webpack.config.js --open --inline --progress&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><code>test.vue</code>中的文件大家看心情来就好，<code>main.js</code>就是正常的<code>vue</code>启动入口，这里我就不多赘述了。</p> <p>当我们修改的<code>test.vue</code>时，</p> <h3 id="第一步-webpack将打包之后的文件放入内存之中"><a href="#第一步-webpack将打包之后的文件放入内存之中" class="header-anchor">#</a> 第一步：webpack将打包之后的文件放入内存之中</h3> <p><code>webpack-dev-middleware</code> 通过调用 <code>webpack</code>的 <code>compiler</code> 的 <code>api</code>将打包之后的文件放到内存之中。核心代码如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// webpack-dev-middleware/index.js</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>options<span class="token punctuation">.</span>lazy<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  context<span class="token punctuation">.</span>watching <span class="token operator">=</span> compiler<span class="token punctuation">.</span><span class="token function">watch</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>watchOptions<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>在配置了 <code>writeToDisk</code> 这个配置项时，打包之后的文件会写入到相应的文件夹中。但是在没有这个配置的时候，那么文件有存放在哪里呢？这里我们提到<code>webpack-dev-middleware</code>中的一个依赖<code>memory-fs</code>，看这个名字我们大概就能猜到他是干什么的了。在 <code>webpack</code>的<code>compiler.outputFileSystem</code>会被挂在上<code>memory-fs</code>的实例。核心代码如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// webpack-dev-middleware/lib/fs.js</span>
<span class="token keyword">const</span> isMemoryFs <span class="token operator">=</span> <span class="token operator">!</span>isConfiguredFs <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>compiler<span class="token punctuation">.</span>compilers <span class="token operator">&amp;&amp;</span> compiler<span class="token punctuation">.</span>outputFileSystem <span class="token keyword">instanceof</span> <span class="token class-name">MemoryFileSystem</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>isConfiguredFs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> fs <span class="token punctuation">}</span> <span class="token operator">=</span> context<span class="token punctuation">.</span>options<span class="token punctuation">;</span>
  compiler<span class="token punctuation">.</span>outputFileSystem <span class="token operator">=</span> fs<span class="token punctuation">;</span>
  fileSystem <span class="token operator">=</span> fs<span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>isMemoryFs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  fileSystem <span class="token operator">=</span> compiler<span class="token punctuation">.</span>outputFileSystem<span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  fileSystem <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MemoryFileSystem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  compiler<span class="token punctuation">.</span>outputFileSystem <span class="token operator">=</span> fileSystem<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>如果当前 <code>compiler.outputFileSystem</code> 不是 <code>MemoryFileSystem</code>，那就用 <code>MemoryFileSystem</code> 替换，这样打包的文件就存放在 <code>MemoryFileSystem</code> 所构建的文件系统之中，加快了访问读取的速度了。</p> <h3 id="第二步-devserver在文件编译通知浏览器端"><a href="#第二步-devserver在文件编译通知浏览器端" class="header-anchor">#</a> 第二步：devServer在文件编译通知浏览器端</h3> <p>在<code>webpack</code>的<code>compiler</code>会添加<code>ProgressPlugin</code>插件，统计编译打包的进度，然后通过<code>sockjs</code>与服务端 <code>websocket</code> 通信，将打包的各个状态推送到客户端。此时，还需要知道打包完成的状态，在 <code>compiler.hooks</code> 中监听了 <code>done</code> 事件，然后通过调用 <code>_sendStats</code> 将打包之后的 <code>stats.hash</code>推送浏览器端。核心代码如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// webpack-dev-server/lib/Server.js</span>
<span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>ProgressPlugin</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">percent<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> addInfo</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// ... 使用 ProgressPlugin 插件</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">sockWrite</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>sockets<span class="token punctuation">,</span> <span class="token string">'progress-update'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> percent<span class="token punctuation">,</span> msg <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>compiler<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">setupHooks</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token keyword">const</span> <span class="token function-variable function">addHooks</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> compile<span class="token punctuation">,</span> invalid<span class="token punctuation">,</span> done <span class="token punctuation">}</span> <span class="token operator">=</span> compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">;</span>
    <span class="token comment">// ...</span>
    <span class="token comment">// 添加done事件监听</span>
    done<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">'webpack-dev-server'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">stats</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_sendStats</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>sockets<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getStats</span><span class="token punctuation">(</span>stats<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>_stats <span class="token operator">=</span> stats<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>compiler<span class="token punctuation">.</span>compilers<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>compiler<span class="token punctuation">.</span>compilers<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>addHooks<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">addHooks</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>compiler<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token function">_sendStats</span><span class="token punctuation">(</span><span class="token parameter">sockets<span class="token punctuation">,</span> stats<span class="token punctuation">,</span> force</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token comment">// 推送新的 hash 到浏览器端</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">sockWrite</span><span class="token punctuation">(</span>sockets<span class="token punctuation">,</span> <span class="token string">'hash'</span><span class="token punctuation">,</span> stats<span class="token punctuation">.</span>hash<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><h3 id="第三步-webpack-dev-server-client-接受和处理服务端推送的信息"><a href="#第三步-webpack-dev-server-client-接受和处理服务端推送的信息" class="header-anchor">#</a> 第三步：webpack-dev-server/client 接受和处理服务端推送的信息</h3> <p>在一开始梳理这逻辑的时候，我有点好奇 <code>webpack-dev-server/client</code> 这部分的处理代码是如何打到 <code>bundle</code>之中的？其实在 <code>webpack-dev-server</code> 启动的时候，回去更新 <code>webpack</code> 的 <code>compiler</code>, 然后通过 <code>addEntries</code> 这个插件将这部分的代码注入到客户端之中。核心代码如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// webpack-dev-server/lib/Server.js</span>
<span class="token function">updateCompiler</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>compiler<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">)</span>
<span class="token comment">// webpack-dev-server/lib/utils/updateCompiler.js</span>
<span class="token function">addEntries</span><span class="token punctuation">(</span>webpackConfig<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>
compilers<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
<span class="token comment">// ...</span>
<span class="token keyword">const</span> providePlugin <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>ProvidePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">__webpack_dev_server_client__</span><span class="token operator">:</span> <span class="token function">getSocketClientPath</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">providePlugin</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>compiler<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><code>webpack-dev-server/client</code>在处理 <code>websocket</code>消息会依据不同的 <code>type</code> 来处理消息。当收到 <code>type</code> 为 <code>hash</code>时记录下传递过来的<code>hash</code>值，当前消息的<code>type</code>为<code>ok</code>时，会调用 <code>reloadApp</code>。如下图所示：</p> <p><img src="/blog/assets/img/webpack/plugin/hmr1.png" alt="image"></p> <p>在 <code>reloadApp</code> 这个函数中，主要是通过<code>webpack/hot/emitter</code>触发<code>webpackHotUpdate</code>事件，并将最新的 <code>hash</code>作为参数传递过去，如果没有配置<code>hot参数</code>，则会在宏任务中来进行页面刷新的操作。
核心代码如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// webpack-dev-server/client-src/default/index.js</span>
<span class="token keyword">const</span> onSocketMessage <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">hash</span><span class="token punctuation">(</span><span class="token parameter">hash</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    status<span class="token punctuation">.</span>currentHash <span class="token operator">=</span> hash<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">reloadApp</span><span class="token punctuation">(</span>options<span class="token punctuation">,</span> status<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">reloadApp</span><span class="token punctuation">(</span>
  <span class="token parameter"><span class="token punctuation">{</span> hotReload<span class="token punctuation">,</span> hot<span class="token punctuation">,</span> liveReload <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> isUnloading<span class="token punctuation">,</span> currentHash <span class="token punctuation">}</span></span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>hot<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> hotEmitter <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack/hot/emitter'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    hotEmitter<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'webpackHotUpdate'</span><span class="token punctuation">,</span> currentHash<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>liveReload<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    self<span class="token punctuation">.</span><span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      rootWindow<span class="token punctuation">.</span>location<span class="token punctuation">.</span><span class="token function">reload</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h3 id="第四步-webpack接受到最新的hash验证以及更新模块"><a href="#第四步-webpack接受到最新的hash验证以及更新模块" class="header-anchor">#</a> 第四步：webpack接受到最新的hash验证以及更新模块</h3> <p>在上一步当中我们派发了 <code>webpackHotUpdate</code> 事件，要看在哪里消费了这个事件。在 <code>webpack/hot/dev-server</code>中消费的回调函数中主要是调用了 <code>module.hot.check</code> 方法，</p> <p><code>module.hot</code>这个对象是通过<code>HotModuleReplacementPlugin</code>插件将<code>HotModuleReplacement.runtime</code>之中的代码注入。核心代码如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// webpack/hot/dev-server.js</span>
hotEmitter<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;webpackHotUpdate&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">currentHash</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//...</span>
  module<span class="token punctuation">.</span>hot<span class="token punctuation">.</span><span class="token function">check</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">//...</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// webpack/lib/HotModuleReplacementPlugin.js</span>
<span class="token keyword">const</span> Template <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./Template&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> hotInitCode <span class="token operator">=</span> Template<span class="token punctuation">.</span><span class="token function">getFunctionContent</span><span class="token punctuation">(</span>
	<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./HotModuleReplacement.runtime&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
mainTemplate<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>moduleObj<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span>
  <span class="token string">&quot;HotModuleReplacementPlugin&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span><span class="token parameter">source<span class="token punctuation">,</span> chunk<span class="token punctuation">,</span> hash<span class="token punctuation">,</span> varModuleId</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> Template<span class="token punctuation">.</span><span class="token function">asString</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
      <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>source<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">,</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
      <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">hot: hotCreateModule(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>varModuleId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">),</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token comment">// 将 hmr.runtime 中的 api 注入到 module 之中</span>
      <span class="token string">&quot;parents: (hotCurrentParentsTemp = hotCurrentParents, hotCurrentParents = [], hotCurrentParentsTemp),&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;children: []&quot;</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// webpack/lib/HotModuleReplacement.runtime.js</span>
<span class="token keyword">function</span> <span class="token function">hotCreateModule</span><span class="token punctuation">(</span><span class="token parameter">moduleId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">var</span> hot <span class="token operator">=</span> <span class="token punctuation">{</span>
			<span class="token literal-property property">check</span><span class="token operator">:</span> hotCheck<span class="token punctuation">,</span>
      <span class="token comment">// other api</span>
		<span class="token punctuation">}</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> hot<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><p><code>hotCheck</code>方法会调用 <code>JsonpMainTemplate.runtime</code>中的两个方法 <code>hotDownloadManifest</code>和<code>hotDownloadUpdateChunk</code>，前者通过上一步传入的<code>hash</code>发起<code>ajax</code>请求服务端获取文件更新列表，如图所示；后者依据文件列表发起<code>jsonp</code>请求相应的最新的代码块，继续后续代码更新的逻辑。</p> <p><img src="/blog/assets/img/webpack/plugin/hmr2.png" alt="image"></p> <p><code>hotDownloadManifest</code>方法获取更新文件列表</p> <p><img src="/blog/assets/img/webpack/plugin/hmr3.png" alt="image"></p> <p><code>hotDownloadUpdateChunk</code>获取到更新的新模块代码。</p> <div class="custom-block tip"><p class="title"></p><p>在这里我一直有一个疑问，并且我自己想了一段时间也没有想通用的问题，就是为什么要通过上述的这种方式来更新。从技术来说，当服务端推送消息<code>type</code>为<code>ok</code>时，可以吧更新之后的代码块也一并推送过来，但是为什么没有这么做呢？看了其他的解释是，<strong>模块解耦</strong>，<code>dev-server/client</code> 只负责消息的传递，<code>HotModuleReplacement</code>来负责代码模块的的更新，这样复合单一设计的原则，而且 <code>webpack</code> 在不使用 <code>dev-server</code>的情况下，可以配合 <code>webpack-hot-middleware</code> 来实现热更新功能，<code>webpack-hot-middleware</code>使用的协议并不是<code>websocket</code>而是<code>SSE</code>协议，这种协议在<code>flutter-devtools</code>也有使用到，可以很好的把模块的功能进行解耦。</p></div><h3 id="第五步-hotmodulereplacement-runtime-更新模块"><a href="#第五步-hotmodulereplacement-runtime-更新模块" class="header-anchor">#</a> 第五步：HotModuleReplacement.runtime 更新模块</h3> <p>在上述 <code>jsonp</code> 请求中我们看到其调用了 <code>webpackHotUpdate</code> 这个方法，通过打包出来的 <code>bundle.js</code>可以看到它又调用了<code>JsonpMainTemplate.runtime</code>中的<code>webpackHotUpdateCallback</code>，这其中主要是调用了 <code>HotModuleReplacement.runtime</code>的 <code>hotAddUpdateChunk</code>，后面一系列的调用就不一一详述了，我们来看一下最为核心的方法<code>hotApply</code>。由于这个方法实现的代码较多，我们可以追踪<code>hotStatus</code>的状态变化来梳理更新的逻辑。</p> <ul><li>&quot;idle&quot; =&gt; &quot;check&quot;，这个阶段 <code>module.hot.check</code> 方法。</li> <li>&quot;check&quot; =&gt; &quot;prepare&quot;，这个阶段通过上述的 <code>hotDownloadManifest</code>获取到了最新的文件列表。</li> <li>&quot;prepare&quot; =&gt; &quot;ready&quot;，这个阶段，将新的模块存贮到了 <code>hotUpdate</code> 之中。</li> <li>&quot;ready&quot; =&gt; &quot;dispose&quot;，这个阶段经历了两个循环，在第一个循环中，先通过 <code>getAffectedStuff</code> 方法找到当前这个新模块所有相关的<strong>模块outdatedModules</strong>和<strong>依赖outdatedDependencies</strong>，<code>result</code>返回值如下，如果没有找到的话，将 <code>result.type</code> 表示为 <code>disposed</code>。正常返回 <code>result.type</code>为<code>accepted</code>。</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;accepted&quot;</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;moduleId&quot;</span><span class="token operator">:</span><span class="token string">&quot;./lib/vue-loader/index.js?!./test.vue?vue&amp;type=script&amp;lang=js&amp;&quot;</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;outdatedModules&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span>
      <span class="token string">&quot;./lib/vue-loader/index.js?!./test.vue?vue&amp;type=script&amp;lang=js&amp;&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;./test.vue?vue&amp;type=script&amp;lang=js&amp;&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;./test.vue&quot;</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;outdatedDependencies&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>在第二个循环中，找出<strong>outdatedModules</strong>中，并且已经被使用的模块中 <code>hot._selfAccepted</code>为 <code>true</code>的模块，这些模块通过都自己调用的 <img src="/bloghttps://webpack.docschina.org/api/hot-module-replacement/#accept" alt="module.hot.accep">这个方法，对于 <code>vue</code>组件来说，这部分的代码是在<code>vue-loader</code>中注入的，核心代码如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>
  installedModules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span>
  installedModules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">.</span>hot<span class="token punctuation">.</span>_selfAccepted <span class="token operator">&amp;&amp;</span>
  <span class="token comment">// removed self-accepted modules should not be required 不需要移除自我接受的模块</span>
  appliedUpdate<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span> <span class="token operator">!==</span> warnUnexpectedRequire
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  outdatedSelfAcceptedModules<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">module</span><span class="token operator">:</span> moduleId<span class="token punctuation">,</span>
    <span class="token literal-property property">errorHandler</span><span class="token operator">:</span> installedModules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">.</span>hot<span class="token punctuation">.</span>_selfAccepted
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><ul><li>&quot;dispose&quot; =&gt; &quot;apply&quot;，在这个阶段，遍历<strong>outdatedModules</strong>，从<strong>installedModules</strong>已经安装的模块中删除过期模块以及被该模块引用的子模块，还要删除删除依赖，核心代码如下：</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> queue <span class="token operator">=</span> outdatedModules<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">while</span> <span class="token punctuation">(</span>queue<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  moduleId <span class="token operator">=</span> queue<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  module <span class="token operator">=</span> installedModules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>module<span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>
  <span class="token comment">// remove module from cache</span>
  <span class="token keyword">delete</span> installedModules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token comment">// when disposing there is no need to call dispose handler</span>
  <span class="token keyword">delete</span> outdatedDependencies<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token comment">// remove &quot;parents&quot; references from all children</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span>j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> module<span class="token punctuation">.</span>children<span class="token punctuation">.</span>length<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> child <span class="token operator">=</span> installedModules<span class="token punctuation">[</span>module<span class="token punctuation">.</span>children<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>child<span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>
    idx <span class="token operator">=</span> child<span class="token punctuation">.</span>parents<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>moduleId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>idx <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      child<span class="token punctuation">.</span>parents<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>idx<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><ul><li>&quot;apply&quot; =&gt; &quot;fail&quot; or &quot;idle&quot;，在这个阶段主要是更新模块，先将可被更新的模块<code>appliedUpdate</code>挂载到全局的<code>modules</code>上，对于 <code>outdatedSelfAcceptedModules</code>中的模块，会调用 <code>$require$(moduleId)</code>，这里的<code>$require$</code>就是打包出来的 <code>__webpack_require__</code>函数，主要是用来加载模块的。</li></ul> <h3 id="第六步-对-vue-组件是如何自定更新的"><a href="#第六步-对-vue-组件是如何自定更新的" class="header-anchor">#</a> 第六步：对 vue 组件是如何自定更新的</h3> <p><code>test.vue</code>这个模块在被<code>vue-loader</code>解析时，会通过<code>vue-loader/codegen/hotReload.js</code>中的<code>genHotReloadCode</code>方法添加如下代码，其中实现不刷新页面来更新<code>vue</code>组件的核心逻辑在<code>vue2</code>都是由<code>vue-hot-reload-api</code>这个库提供的。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// vue-loader/codegen/hotReload.js genHotReloadCode</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>module<span class="token punctuation">.</span>hot<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> api <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;xxx/node_modules/vue-hot-reload-api/dist/index.js&quot;</span><span class="token punctuation">)</span>
  api<span class="token punctuation">.</span><span class="token function">install</span><span class="token punctuation">(</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'vue'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>api<span class="token punctuation">.</span>compatible<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    module<span class="token punctuation">.</span>hot<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>api<span class="token punctuation">.</span><span class="token function">isRecorded</span><span class="token punctuation">(</span><span class="token string">'13429420'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      api<span class="token punctuation">.</span><span class="token function">createRecord</span><span class="token punctuation">(</span><span class="token string">'13429420'</span><span class="token punctuation">,</span> component<span class="token punctuation">.</span>options<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      api<span class="token punctuation">.</span><span class="token function">reload</span><span class="token punctuation">(</span><span class="token string">'13429420'</span><span class="token punctuation">,</span> component<span class="token punctuation">.</span>options<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    module<span class="token punctuation">.</span>hot<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token string">&quot;./test.vue?vue&amp;type=template&amp;id=13429420&amp;scoped=true&amp;&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      api<span class="token punctuation">.</span><span class="token function">rerender</span><span class="token punctuation">(</span><span class="token string">'13429420'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">render</span><span class="token operator">:</span> render<span class="token punctuation">,</span>
        <span class="token literal-property property">staticRenderFns</span><span class="token operator">:</span> staticRenderFns
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>这里 <code>vue-hot-reload-api</code> 为了支持更热新，它的<strong>核心实现逻辑</strong>是，在组件的生命周期的钩子函数中，插入保存组件上下文的对象的函数，初次渲染是保存当前的组件上下文；当第二次热更新的，先替换组件的 <code>options</code>, 然后调用组件的 <code>$forceUpdate</code>方法来重新渲染。</p> <h2 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h2> <ol><li>通过本文大概了解 <code>webpack hmr</code>整个工作的流程，还有很多的细节没有捕捉到位，比如 <code>webpack-dev-server/client</code> 代码的插入，<code>hotapply</code>里面的弯弯绕绕，以及整个<code>webpack</code>的模块机制的实现，欢迎小伙伴积极探讨。</li> <li>本文参考了 <a href="https://zhuanlan.zhihu.com/p/30669007" target="_blank" rel="noopener noreferrer">Webpack HMR 原理解析<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，感谢大佬的付出，觉得这样的行文思路非常值得借鉴。</li></ol> <h2 id="参考文献"><a href="#参考文献" class="header-anchor">#</a> 参考文献</h2> <ul><li><a href="https://zhuanlan.zhihu.com/p/30669007" target="_blank" rel="noopener noreferrer">Webpack HMR 原理解析<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://webpack.docschina.org/api/hot-module-replacement/#accept" target="_blank" rel="noopener noreferrer">Hot Module Replacement<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></section> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新: </span> <span class="time">1/25/2025, 8:21:32 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/blog/engineering/webpack/loaders/vueLoader.html" class="prev">
          深入 vue-loader 原理
        </a></span> <!----></p></div> <div class="comments-wrapper" style="display:none;"><!----></div></main></div> <!----></div> <ul class="sub-sidebar sub-sidebar-wrapper" style="width:12rem;" data-v-b57cc07c data-v-7dd95ae2><li class="level-2" data-v-b57cc07c><a href="/blog/engineering/webpack/plugins/hotModuleReplace.html#前言" class="sidebar-link reco-side-前言" data-v-b57cc07c>前言</a></li><li class="level-2" data-v-b57cc07c><a href="/blog/engineering/webpack/plugins/hotModuleReplace.html#抛出疑问" class="sidebar-link reco-side-抛出疑问" data-v-b57cc07c>抛出疑问</a></li><li class="level-2" data-v-b57cc07c><a href="/blog/engineering/webpack/plugins/hotModuleReplace.html#hmr-流程图解" class="sidebar-link reco-side-hmr-流程图解" data-v-b57cc07c>HMR 流程图解</a></li><li class="level-2" data-v-b57cc07c><a href="/blog/engineering/webpack/plugins/hotModuleReplace.html#运行demo" class="sidebar-link reco-side-运行demo" data-v-b57cc07c>运行Demo</a></li><li class="level-3" data-v-b57cc07c><a href="/blog/engineering/webpack/plugins/hotModuleReplace.html#第一步-webpack将打包之后的文件放入内存之中" class="sidebar-link reco-side-第一步-webpack将打包之后的文件放入内存之中" data-v-b57cc07c>第一步：webpack将打包之后的文件放入内存之中</a></li><li class="level-3" data-v-b57cc07c><a href="/blog/engineering/webpack/plugins/hotModuleReplace.html#第二步-devserver在文件编译通知浏览器端" class="sidebar-link reco-side-第二步-devserver在文件编译通知浏览器端" data-v-b57cc07c>第二步：devServer在文件编译通知浏览器端</a></li><li class="level-3" data-v-b57cc07c><a href="/blog/engineering/webpack/plugins/hotModuleReplace.html#第三步-webpack-dev-server-client-接受和处理服务端推送的信息" class="sidebar-link reco-side-第三步-webpack-dev-server-client-接受和处理服务端推送的信息" data-v-b57cc07c>第三步：webpack-dev-server/client 接受和处理服务端推送的信息</a></li><li class="level-3" data-v-b57cc07c><a href="/blog/engineering/webpack/plugins/hotModuleReplace.html#第四步-webpack接受到最新的hash验证以及更新模块" class="sidebar-link reco-side-第四步-webpack接受到最新的hash验证以及更新模块" data-v-b57cc07c>第四步：webpack接受到最新的hash验证以及更新模块</a></li><li class="level-3" data-v-b57cc07c><a href="/blog/engineering/webpack/plugins/hotModuleReplace.html#第五步-hotmodulereplacement-runtime-更新模块" class="sidebar-link reco-side-第五步-hotmodulereplacement-runtime-更新模块" data-v-b57cc07c>第五步：HotModuleReplacement.runtime 更新模块</a></li><li class="level-3" data-v-b57cc07c><a href="/blog/engineering/webpack/plugins/hotModuleReplace.html#第六步-对-vue-组件是如何自定更新的" class="sidebar-link reco-side-第六步-对-vue-组件是如何自定更新的" data-v-b57cc07c>第六步：对 vue 组件是如何自定更新的</a></li><li class="level-2" data-v-b57cc07c><a href="/blog/engineering/webpack/plugins/hotModuleReplace.html#总结" class="sidebar-link reco-side-总结" data-v-b57cc07c>总结</a></li><li class="level-2" data-v-b57cc07c><a href="/blog/engineering/webpack/plugins/hotModuleReplace.html#参考文献" class="sidebar-link reco-side-参考文献" data-v-b57cc07c>参考文献</a></li></ul></div></div></div><div class="global-ui"><!----><!----></div></div>
    <script src="/blog/assets/js/commons~ae3b4e4a.464a596b.js" defer></script><script src="/blog/assets/js/commons~7181f674.4662fd2d.js" defer></script><script src="/blog/assets/js/commons~786cfedb.e41f506a.js" defer></script><script src="/blog/assets/js/commons~aace9167.f4e3ef15.js" defer></script><script src="/blog/assets/js/commons~9b484c39.32a77623.js" defer></script><script src="/blog/assets/js/commons~7860dd99.672b1e82.js" defer></script><script src="/blog/assets/js/commons~a72e7967.48eaee7f.js" defer></script><script src="/blog/assets/js/commons~a90c22bc.54f8d524.js" defer></script><script src="/blog/assets/js/commons~929f0a25.dce5cbc5.js" defer></script><script src="/blog/assets/js/commons~c27f1b1d.585814cf.js" defer></script><script src="/blog/assets/js/commons~cdd1d9fd.e1032346.js" defer></script><script src="/blog/assets/js/commons~0bcc290c.a80123bc.js" defer></script><script src="/blog/assets/js/commons~2e021842.acbeda30.js" defer></script><script src="/blog/assets/js/commons~f188b1ac.8e2d0f5c.js" defer></script><script src="/blog/assets/js/commons~d6eb103f.6dc63174.js" defer></script><script src="/blog/assets/js/commons~5c078696.d1d90f20.js" defer></script><script src="/blog/assets/js/commons~f1a1cd68.64a52a3e.js" defer></script><script src="/blog/assets/js/commons~f54afab4.907e7ee2.js" defer></script><script src="/blog/assets/js/commons~54aeb72e.ce3d8ca8.js" defer></script><script src="/blog/assets/js/commons~d0ae3f07.afed1185.js" defer></script><script src="/blog/assets/js/commons~b5906859.15a304df.js" defer></script><script src="/blog/assets/js/commons~ec8c427e.1e7f6dc0.js" defer></script><script src="/blog/assets/js/commons~fdc6512a.396d34f8.js" defer></script><script src="/blog/assets/js/commons~6a2c4da6.149ee583.js" defer></script><script src="/blog/assets/js/commons~205977d4.e74f882a.js" defer></script><script src="/blog/assets/js/commons~7dcdd765.06c066b0.js" defer></script><script src="/blog/assets/js/app.2c482c1e.js" defer></script>
  </body>
</html>
